"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_Utils=require("enigma-minkiele/dist/Utils"),_events=require("events"),_events2=_interopRequireDefault(_events),_objectAssign=require("object-assign"),_objectAssign2=_interopRequireDefault(_objectAssign),_Row=require("react-bootstrap/lib/Row"),_Row2=_interopRequireDefault(_Row),_Col=require("react-bootstrap/lib/Col"),_Col2=_interopRequireDefault(_Col),_FormGroup=require("react-bootstrap/lib/FormGroup"),_FormGroup2=_interopRequireDefault(_FormGroup),_FormControl=require("react-bootstrap/lib/FormControl"),_FormControl2=_interopRequireDefault(_FormControl),_Button=require("react-bootstrap/lib/Button"),_Button2=_interopRequireDefault(_Button),_Constants=require("../../Constants"),Keyboard=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state=r.getResetState(),r}return _inherits(t,e),_createClass(t,[{key:"getResetState",value:function(){return{inputLetter:_Constants.KEYBOARD_EMPTY_STREAM,input:_Constants.KEYBOARD_EMPTY_STREAM,output:_Constants.KEYBOARD_EMPTY_STREAM,pendingInputLetter:_Constants.KEYBOARD_EMPTY_STREAM,groupBy:_Constants.DEFAULT_GROUP_BY}}},{key:"resetState",value:function(){this.setState(this.getResetState())}},{key:"updateInput",value:function(e){var t=this;try{!function(){var r=(0,_Utils.normalizeInput)(e);t.setState(function(e){return{inputLetter:"",pendingInputLetter:r}},function(){t.props.eventManager.emit("change.keyboard.input",t.state.pendingInputLetter)})}()}catch(e){}}},{key:"componentWillReceiveProps",value:function(e){this.state.pendingInputLetter!==_Constants.KEYBOARD_EMPTY_STREAM&&this.setState(function(t){var r={pendingInputLetter:_Constants.KEYBOARD_EMPTY_STREAM,groupBy:t.groupBy};return e.lastEncodedLetter&&(0,_objectAssign2.default)(r,{input:""+t.input+t.pendingInputLetter,output:""+t.output+e.lastEncodedLetter}),r})}},{key:"getGroupedLetters",value:function(e){for(var t="",r=0;r<e.length;r+=this.state.groupBy)t+=e.substr(r,this.state.groupBy)+" ";return t.trim()}},{key:"useGroupBy",value:function(){return this.state.groupBy>0}},{key:"updateGroupBy",value:function(e){e=parseInt(e),e>=0&&this.setState({groupBy:e})}},{key:"renderInputGroup",value:function(e){var t=this,r=void 0,n=void 0;return this.state.output.length>0?(r="input-group",n="input-group-btn"):n="hidden",_react2.default.createElement("div",{className:r},e,_react2.default.createElement("span",{className:n},_react2.default.createElement(_Button2.default,{bsStyle:"danger",onClick:function(){t.resetState()}},"Reset")))}},{key:"render",value:function(){var e=this;return _react2.default.createElement("div",{className:"keyboard"},_react2.default.createElement(_Row2.default,null,_react2.default.createElement(_Col2.default,{className:"keyboardInput",xs:12,md:2},_react2.default.createElement(_FormGroup2.default,null,this.renderInputGroup(_react2.default.createElement(_FormControl2.default,{type:"text",value:this.state.inputLetter,onChange:function(t){e.updateInput(t.target.value)},maxLength:"1",pattern:"[A-Z]",size:"1",placeholder:"Input"})))),_react2.default.createElement(_Col2.default,{className:"keyboardInput",xs:12,md:5},_react2.default.createElement("strong",null,"Input:")," ",_react2.default.createElement("code",null,this.useGroupBy()?this.getGroupedLetters(this.state.input):this.state.input)),_react2.default.createElement(_Col2.default,{className:"keyboardOutput",xs:12,md:5},_react2.default.createElement("strong",null,"Output:")," ",_react2.default.createElement("code",null,this.useGroupBy()?this.getGroupedLetters(this.state.output):this.state.output))),_react2.default.createElement(_Row2.default,null,_react2.default.createElement(_Col2.default,{className:"keyboardOutput",xs:12,md:2},_react2.default.createElement(_FormGroup2.default,{className:"splitSize"},_react2.default.createElement("label",null,"Group output by"),_react2.default.createElement(_FormControl2.default,{type:"number",value:this.state.groupBy,onChange:function(t){e.updateGroupBy(t.target.value)}})))))}}]),t}(_react2.default.Component);exports.default=Keyboard,Keyboard.propTypes={lastEncodedLetter:_react2.default.PropTypes.string.isRequired,eventManager:_react2.default.PropTypes.instanceOf(_events2.default).isRequired},Keyboard.defaultProps={lastEncodedLetter:_Constants.KEYBOARD_EMPTY_STREAM},module.exports=exports.default;